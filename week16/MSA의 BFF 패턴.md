## **_BFF (Backend for Frontend) 패턴이란?_**

최근 **다양한 모바일 장비**를 사용 ⇒ **다양한 클라이언트를 고려**해야 함

⇒ **특화된 처리를 위한 API 조합이나 처리 필요**

이를 위한 **해결 방법으로 BFF(Backend for Frontend) 패턴**이 존재

BFF 패턴은 **API 게이트웨이와 같은 진입점을 하나로 두지 않고 프론트엔드의 유형에 따라 각각 두는 패턴**

**프론트엔드를 위한 백엔드**라는 의미로 **BFF**이라고 부른다.

![https://blog.kakaocdn.net/dn/L8Qgy/btrjdNIytM3/PftqwsiwF5IWcFqZPU1Er0/img.png](https://blog.kakaocdn.net/dn/L8Qgy/btrjdNIytM3/PftqwsiwF5IWcFqZPU1Er0/img.png)

**각 프론트엔드에 대한 처리만 수행하는 BFF**를 두고, 이후에 **통합적인 API 게이트웨이**를 둠으로써 **공통적인 인증/인가, 로깅 등의 처리를 통제**하는 구조로 작성

## **_외부 구성 저장소 패턴_**

**애플리케이션 구성 정보 설정**에 관련된 패턴

중요 개념: **컨피그(Config)**

**애플리케이션이 배포되는 환경(스테이징, 프로덕션, 개발, 테스트 환경)이 매번 달라지기 때문에 코드에서 사용하는 환경 설정 정보는 코드와 완전히 분리되어 관리되어야 한다**는 원칙

즉, **클라우드에서 운영되는 애플리케이션은 특정한 배포 환경에 종속된 정보를 코드에 두면 안 된다**는 것

왜냐하면 **이러한 정보를 애플리케이션에 두면 배포 환경이 변경되었을 때 애플리케이션 또한 변경해야 하기 때문**

ex1) **데이터베이스 연결 정보, 배포 시 변경해야 할 호스트명, 백엔드 서비스의 연결을 위한 리소스 정보 등**

ex2) **서비스가 가동되는 개발 서버, 테스트, 운영 서버의 IP 주소와 포트 정보 등을 분리해서 환경 변수로 사용**

![https://blog.kakaocdn.net/dn/cRM3ll/btrjctRqnit/PPVGs9grmmPc978NmgiRn0/img.jpg](https://blog.kakaocdn.net/dn/cRM3ll/btrjctRqnit/PPVGs9grmmPc978NmgiRn0/img.jpg)

## **_인증/인가 패턴_**

**여러 마이크로서비스에 대한 인증/인가 등 접근 제어를 구현**할 때 **각 서비스가 모두 인증/인가를 중복으로 구현한다면 비효율적**이다.

따라서 마이크로서비스 인증/인가를 처리하기 위해서 일반적으로 다음과 같은 패턴을 활용한다.

### **1. 중앙 집중식 세션 관리**

마이크로 서비스는 **사용량에 따라 수시로 수평 확장할 수 있고 로드 밸런싱 처리가 되기 때문에 세션 데이터가 손실**될 수 있다.

따라서 마이크로 서비스는 **각자의 서비스에 세션을 저장하지 않고 공유 저장소에 세션을 저장**하고 **모든 서비스가 동일한 사용자 데이터를 얻게** **한다.**

(이때 세션 저장소로 **레디스**나 **맴캐시드**를 사용)

### **2. 클라이언트 토큰**

**세션은** **중앙 서버에서 저장**되고, **토큰은 사용자의 브라우저에 저장**된다.

**토큰은 사용자의 신원 정보를 가지고 있고 서버로 요청을 보낼 때 전송**되어 **서버에서 인가 처리**를 한다.

![https://blog.kakaocdn.net/dn/bmP9xG/btrjiKSqiXa/wJCCwyamkG1hVj0oNb3gGk/img.jpg](https://blog.kakaocdn.net/dn/bmP9xG/btrjiKSqiXa/wJCCwyamkG1hVj0oNb3gGk/img.jpg)

1. 브라우저가 서버에 사용자 명과 패스워드로 인증 요청

2. 서버는 인증 후 토큰을 생성하고 브라우저에 토큰에 사용자 정보의 인증/인가 정보를 포함에 전송

3. 브라우저는 서버 리소스를 요청할 때 토큰을 함께 보내고, 서버의 서비스는 토큰 정보를 확인한 후 자원 접근을 허가

### **3. API 게이트웨이를 사용한 클라이언트 토큰**

사용자 인증 프로세스는 토큰 인증 프로세스와 유사

차이점은 **API 게이트웨이가 외부 요청의 입구로 추가된다**는 것

⇒ **API 게이트웨이와 연동해서 인증/인가를 처리**

**인증/인가를 처리하기 위한 별도의 인증 서비스를 만들어서 다른 서비스의 인증/인가 처리를 위임하기도 함**

=> 이렇게 하면 **각 리소스 서비스가 자체적으로 인증/인가를 처리하지 않고 업무 처리에 집중**할  수 있음

![https://blog.kakaocdn.net/dn/EJNCS/btrjetYxXCG/tkMVbacuXHcWis37d3mMz0/img.jpg](https://blog.kakaocdn.net/dn/EJNCS/btrjetYxXCG/tkMVbacuXHcWis37d3mMz0/img.jpg)

1. 클라이언트가 리소스 서비스에 접근을 요청하면 **API  게이트웨이는 인증 서비스에게 전달**합니다.

2. 인증 서비스는 해당 요청이 인증된 사용자가 보낸 것인지(**인증**)와 해당 리소스에 대한 접근 권한이 있는지(**인가**) 확인하고

모두 확인하고 나면 **리소스에 접근 가능한 증명서인 access token을 발급**

3. 클라이언트는 다시 **access token**을 활용해  접근 요청

4. 각 리소스 서비스는 이러한 요청이 **access token**을 포함하고 있는지 판단해서 리소스에 대한 접근을 허용
